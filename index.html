<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnostic Culture Sécurité des Aliments - AFNOR SPEC 2406</title>
    
    <!-- Chart.js pour le graphique -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- FontAwesome pour les icônes -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Police Google -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --afnor-purple: #4a148c; /* Violet sombre inspiré du document */
            --afnor-light-purple: #7c43bd;
            --afnor-gold: #fbbf24;
            --bg-color: #f8f9fa;
            --text-color: #333;
            --white: #ffffff;
            --border-radius: 8px;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
        }

        /* --- HEADER --- */
        header {
            background: linear-gradient(135deg, var(--afnor-purple), var(--afnor-light-purple));
            color: white;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        header h1 { margin: 0; font-size: 1.8rem; }
        header p { opacity: 0.9; margin-top: 5px; }

        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 0 15px;
        }

        /* --- ACCORDEON STYLES --- */
        .accordion-item {
            background: var(--white);
            border-radius: var(--border-radius);
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            overflow: hidden;
            border: 1px solid #e0e0e0;
        }

        .accordion-header {
            background-color: var(--white);
            padding: 15px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }

        .accordion-header:hover {
            background-color: #f3e5f5;
        }

        .accordion-header.active {
            background-color: #ede7f6;
            border-bottom: 2px solid var(--afnor-light-purple);
        }

        .accordion-title {
            font-weight: 700;
            color: var(--afnor-purple);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .accordion-icon {
            transition: transform 0.3s;
        }

        .accordion-header.active .accordion-icon {
            transform: rotate(180deg);
        }

        /* Contenu caché par défaut */
        .accordion-content {
            display: none;
            padding: 20px;
            background-color: #fff;
            animation: slideDown 0.3s ease-out;
        }

        .accordion-content.show {
            display: block;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- CONSEILS BOX --- */
        .tips-box {
            background-color: #fffbeb;
            border-left: 5px solid var(--afnor-gold);
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        .tips-title { font-weight: bold; color: #b45309; margin-bottom: 5px; display: block; }

        /* --- QUESTIONS SLIDERS --- */
        .question-row {
            margin-bottom: 25px;
            border-bottom: 1px dashed #eee;
            padding-bottom: 15px;
        }

        .question-label {
            font-weight: 500;
            margin-bottom: 10px;
            display: block;
        }

        .range-wrap {
            position: relative;
            margin: 0 auto 1rem;
        }

        input[type=range] {
            width: 100%;
            cursor: pointer;
            accent-color: var(--afnor-purple);
        }

        .range-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #777;
        }

        .score-badge {
            background: var(--afnor-purple);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            float: right;
        }

        /* --- ACTION BUTTONS --- */
        .btn-action {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: var(--afnor-purple);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 30px;
            margin-bottom: 50px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 20, 140, 0.4);
        }

        /* --- VUE RAPPORT (Initialement cachée) --- */
        #report-view {
            display: none;
            background: white;
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .report-header {
            text-align: center;
            border-bottom: 2px solid var(--afnor-gold);
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .report-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .score-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--afnor-purple);
        }
        
        .global-score {
            text-align: center;
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--afnor-purple);
            margin: 20px 0;
        }

        .btn-print {
            background-color: #333;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        }

        /* Mode Impression pour avoir un "PDF" propre via le navigateur */
        @media print {
            body { background: white; }
            #audit-form-container, .btn-action, .no-print { display: none !important; }
            #report-view { display: block !important; box-shadow: none; margin: 0; padding: 0; }
            .report-grid { grid-template-columns: 1fr 1fr; } /* Force 2 colonnes */
            header { background: white; color: black; border-bottom: 1px solid #000; padding: 10px; }
            header h1 { font-size: 1.5rem; }
            .container { max-width: 100%; margin: 0; width: 100%; }
        }

        @media (max-width: 600px) {
            .report-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<header>
    <h1><i class="fas fa-chart-line"></i> FSC Manager</h1>
    <p>Outil d'évaluation - AFNOR SPEC 2406 (Décembre 2025)</p>
</header>

<div class="container">

    <!-- Formulaire d'audit -->
    <div id="audit-form-container">
        <div style="text-align: center; margin-bottom: 20px;">
            <p>Veuillez dérouler chaque section pour évaluer les pratiques de votre organisation.</p>
        </div>
        
        <form id="fscForm">
            <!-- Les accordéons seront générés ici par JS -->
        </form>

        <button type="button" class="btn-action" onclick="generateReport()">
            <i class="fas fa-file-alt"></i> Voir mon Rapport
        </button>
    </div>

    <!-- Vue Rapport (Résultats) -->
    <div id="report-view">
        <div class="report-header">
            <h2>Rapport de Culture de la Sécurité des Aliments</h2>
            <p>Date : <span id="date-display"></span></p>
        </div>

        <div class="global-score">
            Note Globale : <span id="final-score">0</span> / 5
        </div>

        <div class="report-grid">
            <div>
                <h3>Analyse Visuelle</h3>
                <canvas id="radarChart"></canvas>
            </div>
            <div>
                <h3>Détails par Axe</h3>
                <div id="text-analysis">
                    <!-- Analyse générée par JS -->
                </div>
            </div>
        </div>

        <div style="margin-top: 30px; padding: 15px; background: #eef2ff; border-radius: 8px;">
            <h4><i class="fas fa-info-circle"></i> Interprétation</h4>
            <p style="font-size: 0.9rem;">
                <strong>< 3/5 :</strong> Culture réactive. Actions correctives nécessaires sur les fondamentaux.<br>
                <strong>3 - 4/5 :</strong> Culture active. Les systèmes sont en place, l'engagement doit être renforcé.<br>
                <strong>> 4/5 :</strong> Culture proactive. Amélioration continue et ownership sont acquis.
            </p>
        </div>

        <div class="no-print" style="text-align: center; margin-top: 30px;">
            <button class="btn-print" onclick="window.print()"><i class="fas fa-print"></i> Imprimer / Enregistrer en PDF</button>
            <button class="btn-print" style="background: white; color: #333; border: 1px solid #ccc;" onclick="location.reload()">Recommencer</button>
        </div>
    </div>

</div>

<script>
    // --- DONNÉES DU GUIDE AFNOR ---
    const sections = [
        {
            id: 'leadership',
            title: '1. Capacité de jouer un Rôle Moteur',
            icon: 'fa-chess-king',
            tips: "Le leadership ne se limite pas à la direction. Les chefs d'équipe doivent être des relais exemplaires. Attention à la cohérence entre ce qui est dit et les ressources allouées.",
            questions: [
                "R.M1 - La direction fixe des objectifs clairs en matière de sécurité alimentaire.",
                "R.M2 - La direction fait clairement part de ses attentes à l'égard des salariés.",
                "R.M3 - La direction motive les salariés à travailler dans le respect de la sécurité.",
                "R.M4 - La direction donne l’exemple (Walk the talk).",
                "R.M5 - Les questions de sécurité sont traitées rapidement et constructivement.",
                "R.M6 - La direction s’efforce d’améliorer constamment la sécurité."
            ]
        },
        {
            id: 'communication',
            title: '2. Communication',
            icon: 'fa-bullhorn',
            tips: "La communication doit être bidirectionnelle. Les salariés doivent pouvoir remonter les problèmes sans peur de sanction. Utilisez des visuels simples.",
            questions: [
                "C.1 - La communication sur la sécurité est régulière.",
                "C.2 - La communication est claire et compréhensible par tous.",
                "C.3 - Les salariés peuvent communiquer leurs doutes à la direction.",
                "C.4 - L'affichage (visuel) sur la sécurité est présent en permanence.",
                "C.5 - On peut discuter des problèmes de sécurité entre collègues."
            ]
        },
        {
            id: 'implication',
            title: '3. Implication et Engagement',
            icon: 'fa-users',
            tips: "L'implication se mesure quand la direction a le dos tourné. Valorisez les initiatives positives et ne cherchez pas uniquement des coupables.",
            questions: [
                "E.1 - Je suis convaincu de l’importance de la sécurité alimentaire.",
                "E.2 - Mes collègues en sont aussi convaincus.",
                "E.3 - Le travail bien fait (sécurité) est reconnu et récompensé.",
                "E.4 - Je pense que je peux contribuer à la sécurité des produits.",
                "E.5 - Je suis motivé(e) pour atteindre un haut niveau de sécurité."
            ]
        },
        {
            id: 'sensibilisation',
            title: '4. Sensibilisation & Compétences',
            icon: 'fa-brain',
            tips: "La formation ne suffit pas, il faut vérifier l'acquisition des compétences sur le terrain. Attention à la courbe de l'oubli.",
            questions: [
                "S.1 - Je connais les risques liés à mes tâches spécifiques.",
                "S.2 - Mes collègues connaissent leurs risques.",
                "S.3 - Nous sommes attentifs aux problèmes potentiels.",
                "S.4 - La direction a une image réaliste des risques terrain.",
                "S.5 - Les risques sont globalement maîtrisés."
            ]
        },
        {
            id: 'ressources',
            title: '5. Ressources & Moyens',
            icon: 'fa-tools',
            tips: "Rien ne sert d'exiger l'hygiène si les sols sont cassés ou le matériel inadapté. Le budget maintenance est un indicateur clé de culture.",
            questions: [
                "R.1 - Nous avons assez de temps pour travailler en sécurité.",
                "R.2 - Les effectifs sont suffisants.",
                "R.3 - L’infrastructure et les équipements sont en bon état.",
                "R.4 - Les ressources financières sont suffisantes (nettoyage, labo...).",
                "R.5 - Les procédures et instructions sont claires et disponibles."
            ]
        }
    ];

    // --- GÉNÉRATION DU FORMULAIRE ---
    const formContainer = document.getElementById('fscForm');
    
    sections.forEach((sec, index) => {
        let questionsHTML = sec.questions.map((q, qIndex) => `
            <div class="question-row">
                <label class="question-label">${q}</label>
                <div class="range-wrap">
                    <span class="score-badge" id="val-${sec.id}-${qIndex}">3/5</span>
                    <input type="range" min="1" max="5" step="1" value="3" 
                           name="${sec.id}" 
                           oninput="document.getElementById('val-${sec.id}-${qIndex}').innerText = this.value + '/5'">
                    <div class="range-labels">
                        <span>Pas du tout d'accord</span>
                        <span>Neutre</span>
                        <span>Tout à fait d'accord</span>
                    </div>
                </div>
            </div>
        `).join('');

        let html = `
            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAccordion(this)">
                    <span class="accordion-title"><i class="fas ${sec.icon}"></i> ${sec.title}</span>
                    <i class="fas fa-chevron-down accordion-icon"></i>
                </div>
                <div class="accordion-content">
                    <div class="tips-box">
                        <span class="tips-title"><i class="fas fa-lightbulb"></i> Le conseil du Guide :</span>
                        ${sec.tips}
                    </div>
                    ${questionsHTML}
                </div>
            </div>
        `;
        formContainer.insertAdjacentHTML('beforeend', html);
    });

    // --- LOGIQUE ACCORDEON ---
    function toggleAccordion(header) {
        const content = header.nextElementSibling;
        
        // Fermer les autres (optionnel, pour garder propre)
        document.querySelectorAll('.accordion-content').forEach(c => {
            if (c !== content) {
                c.classList.remove('show');
                c.previousElementSibling.classList.remove('active');
            }
        });

        header.classList.toggle('active');
        content.classList.toggle('show');
    }

    // --- GÉNÉRATION RAPPORT ---
    function generateReport() {
        // 1. Calculs
        const scores = [];
        const labels = [];
        let totalSum = 0;
        let totalCount = 0;
        let detailsHTML = '';

        sections.forEach(sec => {
            const inputs = document.getElementsByName(sec.id);
            let sum = 0;
            inputs.forEach(inp => sum += parseInt(inp.value));
            let avg = (sum / inputs.length).toFixed(1);
            
            scores.push(avg);
            labels.push(sec.title.split('. ')[1]); // Juste le titre sans le numéro
            totalSum += parseFloat(avg);
            totalCount++;

            // Génération bloc détail
            let colorClass = avg >= 4 ? '#2e7d32' : (avg >= 3 ? '#f57f17' : '#c62828');
            detailsHTML += `
                <div class="score-card" style="margin-bottom:10px; border-left-color:${colorClass}">
                    <strong>${sec.title}</strong>
                    <div style="float:right; font-weight:bold; color:${colorClass}">${avg}/5</div>
                </div>
            `;
        });

        let finalScore = (totalSum / totalCount).toFixed(1);

        // 2. DOM Manipulation
        document.getElementById('audit-form-container').style.display = 'none';
        document.getElementById('report-view').style.display = 'block';
        
        document.getElementById('date-display').innerText = new Date().toLocaleDateString('fr-FR');
        document.getElementById('final-score').innerText = finalScore;
        document.getElementById('text-analysis').innerHTML = detailsHTML;

        // 3. Chart.js
        const ctx = document.getElementById('radarChart').getContext('2d');
        new Chart(ctx, {
            type: 'radar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Maturité FSC',
                    data: scores,
                    backgroundColor: 'rgba(74, 20, 140, 0.2)',
                    borderColor: 'rgba(74, 20, 140, 1)',
                    pointBackgroundColor: '#fbbf24',
                    borderWidth: 2
                }]
            },
            options: {
                scales: {
                    r: {
                        suggestedMin: 0,
                        suggestedMax: 5,
                        ticks: { stepSize: 1 }
                    }
                }
            }
        });

        // Scroll top
        window.scrollTo(0, 0);
    }
</script>

</body>
</html>
